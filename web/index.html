<!DOCTYPE html>
<html xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0,user-scalable=0">
    <!-- Set render engine for 360 browser -->
    <meta name="renderer" content="webkit">
    <!-- No Baidu Siteapp-->
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content=""/>
    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileColor" content="#0e90d2">

    <title></title>

    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">-->
    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.css" rel="stylesheet">-->
    <!--<link href="/css/darkstrap.css" rel="stylesheet">-->
    <link href="/css/index.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/vconsole@3.3.4/dist/vconsole.min.js"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>-->
    <!--<script src="https://cdn.jsdelivr.net/npm/vue-router@3.1.3/dist/vue-router.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router@3.1.3/dist/vue-router.js"></script>

</head>
<body>
<div id="header" class="nav nav-tabs navbar-fixed-top hidden-xs">
    <div class="container">
        <div class="navbar-brand">{{title}}</div>
        <ul class="nav navbar-nav ">
            <li v-for="(href,name) in list" :class="{active:name==current}"><a :href="href">{{name}}</a></li>
        </ul>
        <div class="navbar-text navbar-right">{{time}}</div>
    </div>
</div>
<div id="body" :class="['container-fluid']">
    <div id="" class="row">
        <div class="col-lg-1">
            <ul id="leftNavi" class="nav nav-pills nav-stacked ">
                <li v-for="r in routes" :class="{active:_route.path==r.path}">
                    <router-link :to="r.path">{{r.title}}</router-link>
                </li>
            </ul>
        </div>
        <!--<div id="content" class=" col-lg-11">
            <form id="contentForm">
                <label>Name:<input type="text" name="name" value=""></label>
            </form>
            <div id="contentList"></div>
        </div>-->
        <router-view id="content" class=" col-lg-11"></router-view>
    </div>
</div>
<div id="footer" class="nav navbar-fixed-bottom">
    <div class="">
        <ul id="msg" class="nav navbar-nav ">
            <li v-for="(item,k) in list" :class="[
            'glyphicon'
            ,{'btn-success' :item.type=='success'}  ,{'glyphicon-ok'           :item.type=='success'}
            ,{'btn-primary' :item.type=='info'}     ,{'glyphicon-info-sign'    :item.type=='info'}
            ,{'btn-danger'  :item.type=='error'}    ,{'glyphicon-remove-sign'  :item.type=='error'}
            ,{'btn-warning' :item.type=='notice'}   ,{'glyphicon-alert'        :item.type=='notice'}
            ]" v-on:click.self.stop="showDetail(k)">
                <div :class="[
                'hinter'
                ,{'btn-success' :item.type=='success'}
                ,{'btn-primary' :item.type=='info'}
                ,{'btn-danger'  :item.type=='error'}
                ,{'btn-warning' :item.type=='notice'}
                ]">{{item.msg}}
                </div>
            </li>
        </ul>
        <ul id="paginator" class="nav navbar-nav navbar-right">
            <li>
                <a href="javascript:void(0)" v-on:click="prev">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li v-for="offset in pageOffsets" :class="{active:page==offset}" v-on:click="switcher(offset)"><a href="javascript:void(0)">{{offset}}</a></li>
            <!--<li class="disabled"><a href="javascript:void(0)">3</a></li>-->
            <li>
                <a href="javascript:void(0)" v-on:click="next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </div>
</div>
<div id="loader" v-if="isShow" :style="{opacity:isTransparent?0:1}">
    <svg class="square" xmlns="http://www.w3.org/2000/svg" version="1.1" :width="width+'px'" :height="width+'px'">
        <polygon v-for="offset in offsets" :points="offset"></polygon>
        <!--<polygon v-for="offset in offsets" points="0,224.5139883 309.0169944,449.0279766 1000,224.5139883 309.0169944,0"></polygon>-->
    </svg>
</div>
<div id="popup" v-if="isShow" :style="{opacity:isTransparent?0:1}" v-on:click="hide">
    <div v-on:click.stop>
        <table>
            <tr>
                <th colspan="2">editor</th>
            </tr>
            <tr v-for="(val,key) in data">
                <th>{{key}}</th>
                <td>
                    <template v-if="!data[key].editable">
                        {{data[key].data}}
                    </template>
                    <template v-else-if="data[key].type=='text'">
                        <input type="text" v-model="data[key].data">
                    </template>
                    <template v-else-if="data[key].type=='datetime'">
                        <input type="datetime-local" v-model="data[key].data">
                    </template>
                </td>
            </tr>
            <tr>
                <th colspan="2">
                    <button type="button" class="btn btn-warning" v-on:click="reset">close</button>
                    <button type="button" class="btn btn-success" v-on:click="submit">submit</button>
                </th>
            </tr>
        </table>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>

</body>
<script>
    /**
     * @var list
     * @var current
     * @var title
     * @var time
     * @var timer (internal)
     * */
    let header = new Vue(
        {
            el     : '#header',
            data   : {
                list   : {
                    'Tieba'     : 'javascript:void(0)',
                    'Nas'       : 'javascript:void(0)',
                    'Router'    : 'javascript:void(0)',
                    'Hypervisor': 'javascript:void(0)',
                    // 'Router': 'javascript:void(0)',
                    // 'Github': 'javascript:void(0)',
                },
                current: 'Tieba',
                title  : 'Hentai',
                time   : '',
                timer  : 0,
            },
            created: function () {
                this.timer = setInterval(() => {
                    let date = new Date();
                    let arr  = {
                        y: date.getFullYear(),
                        m: date.getMonth() + 1,
                        d: date.getDate(),
                        h: date.getHours(),
                        i: date.getMinutes(),
                        s: date.getSeconds(),
                    };
                    for (let k in arr) {
                        if (arr[k] < 10) arr[k] = '0' + arr[k];
                        arr[k] = arr[k].toString();
                    }
                    this.time = `${arr.y}-${arr.m}-${arr.d} ${arr.h}:${arr.i}:${arr.s}`
                }, 500);
            },
            methods: {}
        });
    /**
     * @var list        (internal)
     * @var detailTimer (internal)
     * @method push         (data, type) type in ['success','info','error','notice']
     * @method showDetail   (index)
     * @method hideAll      ()
     * */
    let msg    = new Vue(
        {
            el     : '#msg',
            data   : function () {
                return {
                    list       : [
                        {
                            type: 'info',
                            msg : 'success',
                        }
                    ],
                    detailTimer: 0,
                }
            },
            created: function () {
            },
            methods: {
                push      : function (data, type) {
                    switch (type) {
                        case 'success':
                        case 'info':
                        case 'error':
                        case 'notice':
                            break;
                        default:
                            type = 'info';
                            break;
                    }
                    if (this.list.length >= 20) {
                        this.list.splice(0, this.list.length - 20);
                    }
                    this.list.push(
                        {
                            type: type,
                            msg : data,
                        });
                },
                showDetail: function (index) {
                    // console.info('show');
                    let target = $('#msg li').eq(index).children('div');
                    target.fadeIn(200, () => {
                        setTimeout(() => {
                            target.fadeOut(200);
                        }, 15000)
                    });
                },
                hideAll   : function () {
                    // console.info('hide');
                    $('#msg li div').stop(true, true).fadeOut(200);
                }
            }
        });
    /**
     * @var page
     * @method reset                (page) 重置分页
     * @method switcher             (page) (internal)
     * @method switcherCallback     (page) 用于替换
     * @method prev
     * @method next
     * */
    let pager  = new Vue(
        {
            el     : '#paginator',
            data   : function () {
                return {
                    page       : 1,
                    pageOffsets: [
                        1, 2, 3, 4, 5,
                    ],
                };
            },
            created: function () {
            },
            methods: {
                reset        : function (page) {
                    this.page = page ? Number.parseInt(page) : 1;
                    this.query();
                },
                query        : function (page) {
                    console.info(`fetch ${page}`);
                    this.page = Number.parseInt(page ? page : this.page);
                    if (this.page < 1) this.page = 1;
                    //生成页数
                    let start        = Math.max(this.page - 2, 1);
                    let end          = start + 4;
                    let targetOffset = [];
                    for (let i1 = start; i1 <= end; i1++) {
                        targetOffset.push(i1);
                    }
                    this.pageOffsets = targetOffset;
                    //
                    this.queryCallback(page);
                },
                queryCallback: function (page) {
                    console.info('queryCallback');
                },
                prev         : function () {
                    this.page -= 1;
                    this.query();
                },
                next         : function () {
                    this.page += 1;
                    this.query();
                },
            }
        });
    /**
     * @var isShow          (internal)
     * @var isTransparent   (internal)
     * @var angle           (internal)
     * @var width           (internal)
     * @var rRatio          (internal)
     * @var inScale         (internal)
     * @var offsets         (internal)
     * @method show         () 显示遮罩
     * @method hide         () 隐藏遮罩
     * @method createStar   (internal)
     * */
    let loader = new Vue(
        {
            el     : '#loader',
            data   : function () {
                return {
                    isShow       : false,
                    isTransparent: true,
                    angle        : 4,
                    width        : 300,
                    rRatio       : 0.5,//外半径
                    inScale      : 0.6,//内半径（参考）
                    offsets      : [],
                }
            },
            created: function () {
                this.createStar(this.width, this.angle, this.rRatio, this.inScale);
            },
            methods: {
                show      : function () {
                    this.isShow = true;
                    //做个延迟不然特效不会出来……
                    setTimeout(() => {
                        this.isTransparent = false;
                    }, 10);
                    popup.hide();
                },
                hide      : function () {
                    this.isTransparent = true;
                    setTimeout(() => {
                        this.isShow = false;
                    }, 500);
                },
                createStar: function (width, angle, rRatio, inScale) {
                    this.offsets = [];
                    let deg      = 360 / angle;
                    let rad      = deg / 180 * Math.PI;
                    let r        = width * inScale;
                    let vX       = r * Math.tan(rad / 4)
                        / (Math.tan(rad / 4) + Math.tan(rad / 2));
                    let vY       = r * Math.tan(rad / 4) * Math.tan(rad / 2)
                        / (Math.tan(rad / 4) + Math.tan(rad / 2));
                    // console.info(deg);
                    // console.info(vX);
                    // console.info(vY);
                    let mid = width / 2;
                    for (let ang = 0; ang < angle; ang++) {
                        let ol  = {
                            x0: mid,
                            y0: mid,
                            x1: mid + vX,
                            y1: mid - vY,
                            x2: mid + width * rRatio,
                            y2: mid,
                            x3: mid + vX,
                            y3: mid + vY,
                        };
                        let str = `${ol.x0},${ol.y0} ${ol.x1},${ol.y1} ${ol.x2},${ol.y2} ${ol.x3},${ol.y3}`;
                        this.offsets.push(str);
                    }
                },
            }
        });
    /**
     * @var isShow          (internal)
     * @var isTransparent   (internal)
     * @var data            (internal)
     * @var callback        (internal)
     * @method show     (data, template, success, cancel, error)
     * @method hide     ()
     * @method reset    ()
     * @method submit   ()
     *
     * show -> data {name:value}
     * show -> template {name:{type:('text'|'datetime'),default:'',editable:(true|false)}}
     * */
    let popup  = new Vue(
        {
            el     : '#popup',
            data   : function () {
                return {
                    isShow       : false,
                    isTransparent: false,
                    data         : {},
                    callback     : {
                        success: function () {
                        },
                        cancel : function () {
                        },
                        error  : function () {
                        },
                    },
                }
            },
            created: function () {
            },
            methods: {
                show  : function (data, template, success, cancel, error) {
                    //这里会产生引用所以逐一写，实现复制

                    for (let k in template) {
                        // {type: 'text', default: '0', editable: true,};
                        let curData  = data[k] ? data[k] : template[k].default;
                        this.data[k] = {
                            data    : curData,
                            type    : template[k].type,
                            default : template[k].default,
                            editable: template[k].editable,
                            before  : curData,
                        };
                    }
                    if (success)
                        this.callback.success = success;
                    if (cancel)
                        this.callback.cancel = cancel;
                    if (error)
                        this.callback.error = error;
                    //***************************************
                    this.isShow = true;
                    //做个延迟不然特效不会出来……
                    setTimeout(() => {
                        this.isTransparent = false;
                    }, 10);
                    loader.hide();
                },
                hide  : function () {
                    //清空数据
                    this.data          = {};
                    this.callback      = {
                        success: function () {
                        },
                        cancel : function () {
                        },
                        error  : function () {
                        },
                    };
                    this.isTransparent = true;
                    setTimeout(() => {
                        this.isShow = false;
                    }, 500);
                },
                reset : function () {
                    this.callback.cancel(this.data);
                    this.hide();
                },
                submit: function () {
                    let data = {};
                    for (let k in this.data) {
                        data[k] = this.data[k].data;
                    }
                    this.callback.success(data);
                    this.hide();
                },
            }
        });
    $(document).click(() => {
        msg.hideAll();
    });
    let empty       = {};
    let op_post     = {
        template: `<div>
<div id="menu">
    <form id="contentForm">
        <label>标题：<input type="text" v-model="query.title" ></label>
        <label>用户名 / 昵称：<input type="text" v-model="query.username" ></label>
        <label>cid：<input type="text" v-model="query.cid" ></label>
        <label>tid：<input type="text" v-model="query.tid" ></label>
        <label><button type="button" v-on:click="switcher" class="btn btn-primary">submit</button></label>
    </form>
</div>
<table>
<tr><th>ID</th>
<th>TID</th>
<th>PID</th>
<th>CID</th>
<th>楼号 / 层号</th>
<th>发帖时间</th>
<th>扫描时间</th>
<th>用户名 / 昵称</th>
<th>标题 / 内容</th>
<th>操作</th>
</tr>
<tr v-for="(item,index) in list">
<td>{{item.id}}</td>
<td>{{item.tid}}</td>
<td>{{item.pid}}</td>
<td>{{item.cid}}</td>
<td>{{item.index_p}} / {{item.index_c}}</td>
<td>{{item.time_pub}}</td>
<td>{{item.time_scan}}</td>
<td>{{item.nickname}} / {{item.username}}</td>
<td v-html="item.content"></td>
<td>
<a class="btn btn-primary" v-on:click="operate(index,'del')">删</a>
<a class="btn btn-primary" v-on:click="operate(index,'forbid')">封</a>
<a class="btn btn-primary" v-on:click="operate(index,'boom')">炸</a>
<a class="btn btn-primary" v-on:click="operate(index,'black')">拉黑</a>
</td>
</tr>
</table>
</div>`,
        data    : function () {
            return {
                refresh      : (new Date()) * 1,
                query        : {
                    title   : '',
                    username: '',
                    cid     : '',
                    tid     : '',
                },
                list         : [],
                popupTemplate: {
                    id       : {type: 'text', default: '', editable: true,},
                    tid      : {type: 'text', default: '', editable: true,},
                    pid      : {type: 'text', default: '', editable: true,},
                    cid      : {type: 'text', default: '', editable: true,},
                    index_p  : {type: 'text', default: '', editable: true,},
                    index_c  : {type: 'text', default: '', editable: true,},
                    time_pub : {type: 'text', default: '', editable: true,},
                    time_scan: {type: 'text', default: '', editable: true,},
                    nickname : {type: 'text', default: '', editable: true,},
                    username : {type: 'text', default: '', editable: true,},
                    content  : {type: 'text', default: '', editable: true,},
                },
            };
        },
        created : function () {
            console.info('created');
            pager.queryCallback = this.switcher;
            //保持页码不知道图什么。。。老代码，如果没有其他问题可以改掉
            pager.reset(router.currentRoute.query.page);
            // this.fetch();
        },
        mounted : function () {
            console.info('mounted');
        },
        watch   : {
            '$route': 'fetch'
        },
        methods : {
            reloadData: function () {
                console.info('reloaded');
                this.refresh = (new Date()) * 1;
            },
            //修改路由
            switcher  : function () {
                console.info('switcher');
                let query = {};
                for (let k in this.query) {
                    query[k] = this.query[k];
                }
                query.page = pager.page;
                //这边刷新会报错，所以加一个路由的判断
                let route  = {name: 'post', query: query};
                if (!router.options.methods.isSameRoute(route)) {
                    console.info('new route:');
                    router.push(route);
                    // console.info(route);
                }
                // console.info(router.currentRoute);
                this.fetch();
            },
            //获取数据
            fetch     : function () {
                console.info('fetch');
                loader.show();
                let queryData = router.currentRoute.query;
                $.post(`/post`, queryData, (data) => {
                    loader.hide();
                    if (data.code) {
                        msg.push(`${data.code} ${data.msg}`, 'error');
                        return;
                    }
                    console.info(this);
                    this.list = data.data;
                    msg.push(`${data.code} ${data.msg}`, 'success');
                    this.reloadData();
                }, 'json');
            },
            //这个是测试
            edit      : function (targetIndex) {
                console.info(targetIndex);
                let target = this.list[targetIndex];
                popup.show(target, this.popupTemplate, (data) => {
                    let modified = false;
                    for (let k in data) {
                        if (this.list[targetIndex][k] == data[k]) continue;
                        this.list[targetIndex][k] = data[k];
                        modified                  = true;
                    }
                    if (modified) {
                        $.post(`/post_modify`, {
                            type      : 'mod',
                            id        : target.id,
                            cat_name  : target.cat_name,
                            text      : target.text,
                            spell     : target.spell,
                            weight    : target.weight,
                            new_weight: target.new_weight,
                        }, (data) => {
                            loader.hide();
                            if (data.code) {
                                msg.push(`${data.code} ${data.msg}`, 'error');
                                return;
                            }
                            console.info(this);
                            msg.push(`${data.code} ${data.msg}`, 'success');
                        }, 'json');
                        this.reloadData();
                    }
                    console.info('success');
                }, () => {
                    console.info('canceled');
                }, () => {
                    console.info('error');
                });
                console.info(target);
            },
            //操作方法
            operate   : function (targetIndex, operate) {
                // let target = this.list[targetIndex];
                popup.show({}, this.popupTemplate, (data) => {
                    $.post(`./dict_base_operate`, {
                        type      : 'add',
                        text      : data.text,
                        spell     : data.spell,
                        weight    : data.weight,
                        new_weight: data.new_weight,
                    }, (data) => {
                        loader.hide();
                        if (data.code) {
                            msg.push(`${data.code} ${data.msg}`, 'error');
                            return;
                        }
                        console.info(this);
                        msg.push(`${data.code} ${data.msg}`, 'success');
                    }, 'json');
                    this.reloadData();
                    console.info('success');
                }, () => {
                    console.info('canceled');
                }, () => {
                    console.info('error');
                });
            },
        }
    };
    let dict_mapBar = {
        template: `<div>
<div id="menu">
    <form id="contentForm">
        <label>地名：
        <select v-model="query.city_name">
            <option value="">请选择</option>
            <option v-for="name in sel_city" :value="name">{{name}}</option>
        </select>
        </label>
        <label>一级分类：
        <select v-model="query.type_1">
            <option value="">请选择</option>
            <option v-for="name in sel_type1" :value="name">{{name}}</option>
        </select>
        </label>
        <label>二级分类：
        <select v-model="query.type_2">
            <option value="">请选择</option>
            <option v-for="name in sel_type2" :value="name">{{name}}</option>
        </select>
        </label></label>
        <label>地名：<input type="text" v-model="query.area_name" ></label>
        <label>ID：<input type="text" v-model="query.id" ></label>
        <label><button type="button" v-on:click="switcher" class="btn btn-primary">submit</button></label>
    </form>
    <div id="extraBtn">
        <button type="button" class="btn btn-info" v-on:click="append">添加</button>
        <button type="button" class="btn btn-success" v-on:click="exportTxt">导出</button>
    </div>
</div>
<table>
<tr><th>ID</th><th>地名</th><th>一级分类</th><th>二级分类</th><th>地名</th><th>操作</th></tr>
<tr v-for="(item,index) in list">
<td>{{item.id        }}</td>
<td>{{item.city_name }}</td>
<td>{{item.type_1    }}</td>
<td>{{item.type_2    }}</td>
<td>{{item.area_name }}</td>
<td>
<a class="btn btn-primary" v-on:click="edit(index)">编辑</a>
<a class="btn btn-primary" v-on:click="del(index)">删除</a>
</td>
</tr>
</table>
</div>`,
        data    : function () {
            return {
                refresh      : (new Date()) * 1,
                query        : {
                    id       : '',
                    city_name: '',
                    type_1   : '',
                    type_2   : '',
                    area_name: '',
                },
                list         : [],
                sel_city     : [],
                sel_type1    : [],
                sel_type2    : [],
                popupTemplate: {
                    id       : {type: 'text', default: 0, editable: false,},
                    city_name: {type: 'text', default: '', editable: true,},
                    type_1   : {type: 'text', default: '', editable: true,},
                    type_2   : {type: 'text', default: '', editable: true,},
                    area_name: {type: 'text', default: '', editable: true,},
                },
            };
        },
        created : function () {
            console.info('created');
            pager.queryCallback = this.switcher;
            pager.reset(router.currentRoute.query.page);
            // this.fetch();
        },
        mounted : function () {
            console.info('mounted');
        },
        watch   : {
            '$route': 'fetch'
        },
        methods : {
            reloadData: function () {
                console.info('reloaded');
                this.refresh = (new Date()) * 1;
            },
            //提交路由
            switcher  : function () {
                console.info('switcher');
                let query = {};
                for (let k in this.query) {
                    query[k] = this.query[k];
                }
                query.page = pager.page;
                //这边刷新会报错，所以加一个路由的判断
                let route  = {name: 'dict_mapBar', query: query};
                if (!router.options.methods.isSameRoute(route)) {
                    console.info('new route:');
                    router.push(route);
                    // console.info(route);
                }
                // console.info(router.currentRoute);
                this.fetch();
            },
            //获取数据
            fetch     : function () {
                console.info('fetch');
                loader.show();
                let queryData = router.currentRoute.query;
                $.post(`./dict_area`, queryData, (data) => {
                    loader.hide();
                    if (data.code) {
                        msg.push(`${data.code} ${data.msg}`, 'error');
                        return;
                    }
                    console.info(this);
                    this.list      = data.data.list;
                    this.sel_city  = data.data.city;
                    this.sel_type1 = data.data.type_1;
                    this.sel_type2 = data.data.type_2;
                    msg.push(`${data.code} ${data.msg}`, 'success');
                    this.reloadData();
                }, 'json');
            },
            edit      : function (targetIndex) {
                console.info(targetIndex);
                let target = this.list[targetIndex];
                popup.show(target, this.popupTemplate, (data) => {
                    let modified = false;
                    for (let k in data) {
                        if (this.list[targetIndex][k] == data[k]) continue;
                        this.list[targetIndex][k] = data[k];
                        modified                  = true;
                    }
                    if (modified) {
                        $.post(`./dict_area_operate`, {
                            type     : 'mod',
                            id       : target.id,
                            city_name: target.city_name,
                            type_1   : target.type_1,
                            type_2   : target.type_2,
                            area_name: target.area_name,
                        }, (data) => {
                            loader.hide();
                            if (data.code) {
                                msg.push(`${data.code} ${data.msg}`, 'error');
                                return;
                            }
                            console.info(this);
                            msg.push(`${data.code} ${data.msg}`, 'success');
                        }, 'json');
                        this.reloadData();
                    }
                    console.info('success');
                }, () => {
                    console.info('canceled');
                }, () => {
                    console.info('error');
                });
                console.info(target);
            },
            append    : function () {
                // let target = this.list[targetIndex];
                popup.show({}, this.popupTemplate, (data) => {
                    $.post(`./dict_area_operate`, {
                        type     : 'add',
                        city_name: data.city_name,
                        type_1   : data.type_1,
                        type_2   : data.type_2,
                        area_name: data.area_name,
                    }, (data) => {
                        loader.hide();
                        if (data.code) {
                            msg.push(`${data.code} ${data.msg}`, 'error');
                            return;
                        }
                        console.info(this);
                        msg.push(`${data.code} ${data.msg}`, 'success');
                    }, 'json');
                    this.reloadData();
                    console.info('success');
                }, () => {
                    console.info('canceled');
                }, () => {
                    console.info('error');
                });
            },
            del       : function (targetIndex) {
                console.info(targetIndex);
                let target = this.list[targetIndex];
                $.post(`./dict_area_operate`, {
                    type: 'del',
                    id  : target.id,
                }, (data) => {
                    loader.hide();
                    if (data.code) {
                        msg.push(`${data.code} ${data.msg}`, 'error');
                        return;
                    }
                    console.info(this);
                    this.list.splice(targetIndex, 1);
                    msg.push(`${data.code} ${data.msg}`, 'success');
                }, 'json');
            },
            exportTxt : function () {
                console.info('export');
                let queryStr = router.currentRoute.fullPath.substr(router.currentRoute.path.length + 1);
                window.open('./dict_area?' + queryStr + '&method=export', 'loader_' + new Date() * 10);
            },
        }
    };
    const routes    = [
        {name: 'post', title: '帖子管理', path: '/post', component: op_post, props: true,},
        {name: 'keyword', title: '关键词管理', path: '/keyword', component: empty, props: true,},
        {name: 'loop', title: '十循名单', path: '/loop', component: empty, props: true,},
        {name: 'log', title: '处理日志', path: '/log', component: empty, props: true,},
        {name: 'settings', title: '系统设置', path: '/settings', component: empty, props: true,},
    ];
    /**
     * @method router.options.methods.isSameRoute
     * */
    const router    = new VueRouter(
        {
            routes : routes,
            data   : function () {
                return {
                    pager: {},
                    query: {},
                };
            },
            methods: {
                isSameRoute: function (to) {
                    let curName  = router.currentRoute.name;
                    let curQuery = router.currentRoute.query;
                    let same     = true;
                    for (let k in to.query) {
                        if (
                            typeof curQuery[k] !== "undefined" && curQuery[k].toString() === to.query[k].toString()
                        ) continue;
                        same = false;
                    }
                    if (curName !== to.name) {
                        same = false;
                    }
                    return same;
                }
            },
        });
    const app       = new Vue(
        {
            router: router,
            el    : '#body',
            data  : function () {
                return {
                    routes: routes,
                };
            }
        });
</script>
</html>
